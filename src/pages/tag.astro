---
const apiUrl = "https://cfg_googledata.it-e3f.workers.dev/?sheet=1pk8YVvDVipo2iHBgV0WtUQaChNXTCKRhq6EcxUBzlN0&f=GFD4R8";

const res = await fetch(apiUrl);
const json = await res.json();

// Trasforma la matrice in array di oggetti
function rowsToObjects(values) {
  const headers = values[0];
  return values.slice(1).map(row => {
    const obj = {};
    headers.forEach((h, i) => {
      obj[h] = row[i] || "";
    });
    return obj;
  });
}

const books = rowsToObjects(json.values);

function parseTags(tagString) {
  return tagString.split(" ").filter(Boolean);
}

const allTags = [
  ...new Set(
    books.flatMap(book => parseTags(book.tag))
  )
];
---

<html>
  <body>
    <h1>Tutti i Tag</h1>
    <ul>
      {allTags.map(tag => (
        <li><a href={`/tags/${tag.replace("#","")}`}>{tag}</a></li>
      ))}
    </ul>
  </body>
</html>
